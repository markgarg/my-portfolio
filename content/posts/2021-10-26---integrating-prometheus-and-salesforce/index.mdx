---
title: Wiring it up - integrating Salesforce.com with Prometheus
date: "2021-07-10T11:15:00.000Z"
slug: "integrating-salesforce-with-prometheus"
template: "post"
draft: true
category: "monitoring"
tags:
  - "monitoring"
  - "salesforce"
description: Explains how to invoke the Salesforce.com API from Prometheus to collect metrics.
---

_This is a part of [series of blog posts about advanced monitoring techniques for your Salesforce.com application](/series-about-monitoring-your-salesforce-enterprise) so your business can rely on the tech team._

_So far, we've covered:_

1. _[A case for better monitoring](/a-case-for-better-monitoring)_
2. _[Slack alerts for Salesforce.com](/slack-alerts-for-salesforce)_
3. _[Taking it to the next level for monitoring the Salesforce.com Enterprise](/next-level-monitoring-for-your-salesforce-enterprise)_
4. _[Installing Prometheus on Heroku](/installing-prometheus-on-heroku)_
5. _[Exposing a Salesforce API that Prometheus can call](/creating-salesforce-api-to-invoke-from-prometheus)_

## Prometheus config

Prometheus runs off the config file, which is in YAML syntax. Prometheus download comes with a default config file called `prometheus.yml` which has some default config in it.

The main blocks of config for us to start off are the `global` and `scrape_configs`.

The `global` block covers the overall configuration for the server. The `scrape_interval` will determine how frequently the targets are polled a.k.a _scraped_ to fetch metrics. This interval can be overridden in each of the specific target as needed.

### Scrape Config

Let's look at the Prometheus config file of [our example repo](https://github.com/markgarg/sample-prometheus-on-heroku/blob/master/prometheus.yml). The `scrape_configs` is where we can specify what resources Prometheus monitors. That is, the URLs of what systems we want to monitor.

It allows us to specify the path to call (via `metrics_path`), frequency (via the `scrape_interval`), and some auth mechanisms : Basic, Bearer or OAuth 2.0 config.

The full list of options available is in the [documentation here](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config).

Let's create a simple `scrape_config` for our demo.

```yml
global:
  scrape_interval: 10s

scrape_configs:
  - job_name: 'prometheus'
    scrape_interval: 5s
    static_configs:
      - targets: ['localhost']
 - job_name: 'salesforce'
    metrics_path: '/services/apexrest/api/v1/prometheus'
    scheme: http
    static_configs:
      - targets: ['test.secure.force.com']
```

In this example, we have two scrape configs:

1. A default one called `prometheus` which, as you can see, is used to monitor itself.
2. The other one is the one we are after - called `salesforce`, and we are stating that the API is exposed at `http://test.secure.force.com/services/apexrest/api/v1/prometheus` albeit in different config keys.

Next:

- _Wrapping the series!_
